#include "../src/utils/minunit.h"
#include "../src/protocol/packet.h"
#include "test_packet.h"

static char* test_packet_parsing() {
    uint8_t raw_pkt[] = { 
        0x45, 0x00, 0x00, 0x28, 0x12, 0x34, 0x40, 0x00, 
        0x40, 0x06, 0x00, 0x00, 0x7f, 0x00, 0x00, 0x01, 
        0x7f, 0x00, 0x00, 0x01, 0x04, 0xd2, 0x00, 0x50,
        0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 
        0x50, 0x02, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00
    };

    packet_t p;
    parse_packet(&p, raw_pkt, sizeof(raw_pkt));

    mu_assert("Packet invalid", p.valid == 1);
    mu_assert("Not TCP", p.ip->protocol == 6);
    return 0;
}

char* test_packet_suite() {
    mu_run_test(test_packet_parsing);
    return 0;
}